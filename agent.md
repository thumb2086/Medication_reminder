# Dynamic Agent Workflow: Context-Aware Execution

此工作流程設計為動態切換模式。**核心原則：規劃與執行必須嚴格分離，且執行後必須同步所有文件。**

## 核心判斷邏輯 (Core Logic - The Safety Catch)
Agent 必須嚴格遵守以下判斷，**預設停留於 Mode A**：

1.  **Mode A (規劃模式) - 預設狀態:**
    *   當使用者指令涉及：修改文檔、討論功能、調整順序、修正 `todo.md` 錯字、或指令不明確時。
    *   **行動:** 僅修改 `todo.md` 或相關文檔。
    *   **禁止:** **在此模式下，嚴禁修改任何 `.kt`, `.java`, `.xml` 或 Gradle 檔案。**

2.  **Mode B (執行模式) - 需顯式觸發:**
    *   僅當使用者**明確發出**執行指令時（關鍵字：`開始`, `執行`, `實作`, `Implement`, `Start`, `Go`, `修復代碼`）。
    *   **行動:** 讀取 `todo.md` 並修改程式碼，完成後更新所有相關文件。

---

## Mode A: 架構規劃與提案 (Architect & Plan)
**目標:** 準備與確認藍圖。
**結束條件:** 更新完 `todo.md` 後**立即停止**，等待使用者指令。

1.  **處理變更:**
    *   根據使用者需求更新 `todo.md`（新增提案、調整版本、修復文檔錯誤）。
    *   確保 `todo.md` 的版本號與任務描述清晰。
2.  **主動暫停 (The Halt):**
    *   完成文檔修改後，**不要**檢查代碼，**不要**嘗試實作。
    *   直接回報修改結果，並詢問下一步。

---

## Mode B: 開發與執行 (Develop & Execute)
**目標:** 實作已確認的計畫，並確保文檔與代碼一致。
**啟動條件:** 收到明確的「執行」指令 + `todo.md` 中有明確的待辦事項。

1.  **鎖定目標 (Target Lock):**
    *   讀取 `todo.md`，鎖定使用者指定的版本 (或當前第一個未完成版本)。
2.  **實作循環 (Coding Loop):**
    *   **Write:** 根據任務描述修改程式碼。
    *   **Build & Fix:** 模擬編譯與除錯。
3.  **文件與結案 (Documentation & Closing):**
    *   **Log:** 更新 `log.md`，記錄技術細節與變更檔案。
    *   **Roadmap:** 更新 `todo.md`，將完成項目打勾 `[x]`。
    *   **README 同步 (關鍵):**
        *   檢查本次變更是否涉及「新功能」、「UI 調整」或「設定變更」。
        *   若有，**必須同時更新** `README.md` (英文) 與 `README_CN.md` (中文)。
        *   確保功能列表、截圖說明或安裝步驟反映最新狀態。

---

## 狀態回報範本 (Status Reporting Templates)

結束回應時，請參考以下格式**根據實際情況動態生成**摘要：

*   **若在 Mode A (規劃) - 必須包含「等待指令」的語氣:**
    > "已更新 `todo.md`：{簡述修改}。**目前尚未開始執行代碼**，請確認規劃無誤，若準備好了請告訴我『開始執行』。"

*   **若在 Mode B (執行):**
    > "{當前版本號} 執行完畢。已完成功能：{列出主要功能}。相關文件 (`log.md`, `todo.md`, `README`) 皆已同步更新。請檢查。"