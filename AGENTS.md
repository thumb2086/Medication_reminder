# Dynamic Agent Workflow: Context-Aware & Data Integrity (v7)

æ­¤å·¥ä½œæµç¨‹æ ¸å¿ƒï¼š**ç ´é™¤å·¥å…·é™åˆ¶ï¼Œå¼·åˆ¶åŸ·è¡Œå…¨åŸŸæª”æ¡ˆï¼ˆåŒ…å« ESP32 C++/Headerï¼‰æ‰‹å‹•è¨ºæ–·èˆ‡ä¿®æ”¹ã€‚**

## ðŸ›‘ æ•¸æ“šå®Œæ•´æ€§èˆ‡æª”æ¡ˆç¯„åœ (SCOPE & INTEGRITY)

1.  **å…¨èªžç³»æª”æ¡ˆæ”¯æŒï¼š**
    *   **Android:** `.kt`, `.java`, `.xml`, `.gradle`
    *   **ESP32/Embedded:** `.h`, `.cpp`, `.ino`, `.c`
    *   **æ–‡ä»¶:** `log.md`, `todo.md`, `README.md`
2.  **`log.md` æ­·å²ä¿è­·ï¼š** çµ•å°ç¦æ­¢è¦†è“‹èˆŠç´€éŒ„ï¼Œä¸€å¾‹æŽ¡ç”¨**é ‚éƒ¨æ’å…¥ (Prepending)**ã€‚
3.  **`todo.md` ç²¾æº–æ¸…ç†ï¼š** åŸ·è¡Œå‰åˆªé™¤ `[x]`ï¼ŒåŸ·è¡Œä¸­åš´ç¦åˆªé™¤ `[ ]`ã€‚

---

## ðŸ” è‡ªæˆ‘é™¤éŒ¯èˆ‡è·¯å¾‘ä¿®å¾©æ©Ÿåˆ¶ (Self-Debugging & Path Recovery)

### **ç•¶å·¥å…·å›žå ± "0 file processed" æˆ– "Nothing to report" æ™‚ï¼š**
**Agent å¿…é ˆç«‹å³å•Ÿå‹•ã€Œæ‰‹å‹•æ·±è¹²æ¨¡å¼ (Manual Deep Scan)ã€ï¼š**
1.  **è·¯å¾‘é‡æŽ¢ï¼š** ä½¿ç”¨ `ls -R` æˆ–ç›¸é—œå·¥å…·é‡æ–°ç¢ºèª `esp32/` æˆ– `src/` è³‡æ–™å¤¾ä¸‹çš„çœŸå¯¦è·¯å¾‘ã€‚
2.  **æºç¢¼ç›´è®€ï¼š** ä¸ä¾è³´ Static Analysis å·¥å…·ï¼Œç›´æŽ¥ä½¿ç”¨ `read_file` è®€å– `.h` æˆ– `.cpp` å…§å®¹ã€‚
3.  **é‚è¼¯æ¯”å°ï¼š** æ‰‹å‹•æª¢æŸ¥ C++ æ¨™é ­æª”å®šç¾©ã€è®Šæ•¸ç”Ÿå‘½é€±æœŸã€ä»¥åŠç¡¬é«”è…³ä½ (Pin Assignment) æ˜¯å¦æ­£ç¢ºã€‚

---

## é‚è¼¯åˆ¤æ–·æµç¨‹ (Logic Flow)

### 1. Mode A: è¦åŠƒèˆ‡ç¶­è­· (Architect & Plan)
*   **æ–°å¢žï¼š** ç¢ºèªä¿®æ”¹ç¯„åœæ˜¯å¦åŒ…å« ESP32 éŸŒé«”ã€‚è‹¥æ˜¯ï¼Œå¿…é ˆåœ¨ `todo.md` æ˜Žç¢ºåˆ—å‡ºç¡¬é«”é‚è¼¯è®Šå‹•ã€‚

### 2. Mode B: é–‹ç™¼ã€é™¤éŒ¯èˆ‡åŸ·è¡Œ (Develop, Debug & Execute)

#### **Phase 1: æ¸…ç†èˆ‡è·¯å¾‘ç¢ºèª**
1.  è®€å– `todo.md` ä¸¦æ¸…ç†èˆŠé …ã€‚
2.  **é©—è­‰æª”æ¡ˆè·¯å¾‘ï¼š** ç¢ºä¿ç›®æ¨™ `.h` æˆ– `.cpp` æª”æ¡ˆè·¯å¾‘æ­£ç¢ºã€‚è‹¥è·¯å¾‘ä¸ç¬¦ï¼Œç«‹å³ä¿®æ­£è¦åŠƒã€‚

#### **Phase 2: å¯¦ä½œèˆ‡ã€Œç¡¬é«”-è»Ÿé«”ã€è¯å‹•é™¤éŒ¯**
1.  **ä¿®æ”¹ C++/Headerï¼š**
    *   ç¢ºä¿ `#ifndef`, `#define` æ¨™é ­ä¿è­·æ­£ç¢ºã€‚
    *   æª¢æŸ¥å‡½æ•¸ç°½å (Function Signature) åœ¨ `.h` èˆ‡ `.cpp` ä¸­æ˜¯å¦ä¸€è‡´ã€‚
2.  **è‡ªæˆ‘é™¤éŒ¯æª¢æŸ¥é»žï¼š**
    *   **ç·¨è­¯ä¾è³´ï¼š** æ˜¯å¦æ¼æŽ‰äº† `#include`ï¼Ÿ
    *   **è³‡æºä¸€è‡´ï¼š** Android ç«¯ç™¼é€çš„ Data èˆ‡ ESP32 ç«¯æŽ¥æ”¶çš„ Struct æ˜¯å¦å°é½Šï¼Ÿ
    *   **å¼·åˆ¶ä¿®æ­£ï¼š** è‹¥å·¥å…·å›žå ± 0 æª”æ¡ˆï¼ŒAgent å¿…é ˆ**æ‰‹å‹•åˆ†æž**ä»£ç¢¼é‚è¼¯ä¸¦æŒ‡å‡º bugã€‚

#### **Phase 3: åŽŸå­åŒ–çµæ¡ˆ**
1.  **æ›´æ–° `log.md` (é ‚éƒ¨æ’å…¥)ï¼š**
    *   æ ¼å¼ï¼š`### v1.3.x: ESP32 Firmware Update`
    *   **å¿…é ˆè¨˜éŒ„ï¼š** ä¿®æ”¹äº†å“ªäº›ç¡¬é«”è…³ä½æˆ–é‚è¼¯ã€‚
2.  **æ›´æ–° `todo.md`ï¼š** æ‰“å‹¾å®Œæˆã€‚

---

## ðŸ¤– å°ˆå±¬é™¤éŒ¯æŒ‡ä»¤ï¼šç•¶è‡ªå‹•åŒ–å·¥å…·å¤±æ•ˆæ™‚
**å¦‚æžœ `inspect_code` æ²’æœ‰å›žå ±ä»»ä½•çµæžœï¼ŒAgent å¿…é ˆåŸ·è¡Œä»¥ä¸‹æ“ä½œï¼š**
1.  **ä¸»å‹•æ‡·ç–‘ï¼š** ã€Œå·¥å…·æ²’å ±éŒ¯ä¸ä»£è¡¨æ²’éŒ¯ã€‚ã€
2.  **è®€å–é—œéµæª”æ¡ˆï¼š** è®€å–æ‰€æœ‰åœ¨ `todo.md` ä¸­æåˆ°çš„æª”æ¡ˆã€‚
3.  **æ‰‹å‹•åˆ†æžï¼š**
    *   ã€Œæˆ‘ç™¼ç¾ `ESP32_Controller.cpp` ç¬¬ 45 è¡Œçš„æ•¸æ“šé¡žåž‹èˆ‡ Android ç«¯å®šç¾©çš„ `Int` ä¸ç¬¦ï¼Œé€™æœƒå°Žè‡´æº¢ä½ã€‚ã€
    *   ã€Œæ¨™é ­æª” `.h` å®£å‘Šäº†æ–¹æ³•ï¼Œä½† `.cpp` æ¼æŽ‰äº†å¯¦ä½œã€‚ã€
4.  **å¼·åˆ¶åŸ·è¡Œå¯«å…¥ï¼š** å³ä½¿ `inspect` æ²’çœ‹åˆ°å•é¡Œï¼Œåªè¦é‚è¼¯æœ‰éŒ¯ï¼Œå°±å¿…é ˆåŸ·è¡Œ `write_file`ã€‚

---

## ç‹€æ…‹å›žå ±ç¯„æœ¬ (Mode B å®Œç•¢)

> "âœ… **ä»»å‹™åŸ·è¡Œå®Œç•¢ (å·²ç¹žéŽå·¥å…·é™åˆ¶æ‰‹å‹•ä¿®æ­£)**
>
> 1. **ESP32 ä¿®æ­£**:
     >    - æª”æ¡ˆï¼š`src/main.cpp`, `include/config.h`
>    - ä¿®æ­£ï¼šæ‰‹å‹•ä¿®æ­£äº†å‚³è¼¸å”å®šçš„ Struct å®šç¾©ï¼Œè§£æ±ºäº†è³‡æ–™å°é½Šå•é¡Œã€‚
> 2. **è‡ªæˆ‘é™¤éŒ¯**: å·¥å…·æŽƒæå›žå ±ç‚º 0ï¼Œä½†æˆ‘é€šéŽ**æ‰‹å‹•ä»£ç¢¼å¯©æŸ¥**ç™¼ç¾ä¸¦è§£æ±ºäº†ä»¥ä¸‹å•é¡Œï¼š
     >    - `config.h` ä¸­éºæ¼äº†è…³ä½å®šç¾©ã€‚
>    - ä¿®æ­£äº† `.cpp` ä¸­çš„å‡½æ•¸å¯¦ä½œè¡çªã€‚
> 3. **æ–‡ä»¶åŒæ­¥**:
     >    - `todo.md`: æœ¬æ¬¡ä»»å‹™ `[x]`ã€‚
>    - `log.md`: å·²åœ¨é ‚éƒ¨è¿½åŠ ç´€éŒ„ï¼Œ**å®Œæ•´ä¿ç•™èˆŠæœ‰æ­·å²**ã€‚
>
> è«‹æª¢æŸ¥ `esp32` è³‡æ–™å¤¾ä¸‹çš„è®Šå‹•ã€‚"
